(function(e){"use strict";e.Scoreboard=new Class({Implements:[Options,Events],options:{element:"scoreboard",position:"topCenter",autoStart:false,homeTeamLogo:null,awayTeamLogo:null,homeTeamName:"Home",awayTeamName:"Away",homeTeamShort:null,awayTeamShort:null,homeTeamGoals:0,awayTeamGoals:0,secondLength:1e3,timeDirection:"up",time:"00:00",animationSpeed:300,duration:3e3},initialize:function(e){this.setOptions(e);this.message=new Element("article",{"class":"scoreboard-message",id:"scoreboard-message",styles:{opacity:0}});this.filters=[];this.message.inject($(document.body));this.messageMorph=new Fx.Morph(this.message,{duration:this.options.animationSpeed,link:"chain"});this.messageQueue=[];if(this.options.homeTeamShort===null){this.options.homeTeamShort=String.shortName(this.options.homeTeamName)}if(this.options.awayTeamShort===null){this.options.awayTeamShort=String.shortName(this.options.awayTeamName)}this.element=document.id(this.options.element);this.setPosition().build().attach()},attach:function(){this.addEvent("change",function(e,t){this.getScoreboardElement(e).set("html",t)});return this},detach:function(){return this},build:function(){var e=this;Object.each(this.options,function(t,n){e.getScoreboardElement(n).set("html",t)});if(this.options.autoStart){this.startTime()}return this},setPosition:function(){if(this.options.position==="topCenter"){this.element.setStyles({position:"absolute",top:"20px",left:"50%",marginLeft:-(this.element.getWidth()/2)})}else if(this.options.position==="topLeft"){this.element.setStyles({position:"absolute",top:"20px",left:"20px"})}else if(this.options.position==="topRight"){this.element.setStyles({position:"absolute",top:"20px",right:"20px"})}else if(this.options.position==="bottomLeft"){this.element.setStyles({position:"absolute",bottom:"20px",left:"20px"})}else if(this.options.position==="bottomRight"){this.element.setStyles({position:"absolute",bottom:"20px",right:"20px"})}else if(this.options.position==="bottomCenter"){this.element.setStyles({position:"absolute",bottom:"20px",left:"50%",marginLeft:-(this.element.getWidth()/2)})}else if(this.options.position==="center"){this.element.setStyles({position:"absolute",bottom:"50%",left:"50%",marginLeft:-(this.element.getWidth()/2),marginTop:-(this.element.getHeight()/2)})}return this},get:function(e){return this.options[e]},set:function(e,t){this.options[e]=t;this.fireEvent("change",[e,t]);return this},setName:function(e,t,n){n=n||String.shortName(t);if(e==="home"){this.set("homeTeamName",t);this.set("homeTeamShort",n.toUpperCase())}else{this.set("awayTeamName",t);this.set("awayTeamShort",n.toUpperCase())}return this},addGoal:function(e){var t;if(e==="home"){t=this.get("homeTeamGoals");t+=1;t=this.filter("addHomeTeamGoal",t);this.set("homeTeamGoals",t)}else if(e==="away"){t=this.get("awayTeamGoals");t+=1;t=this.filter("addAwayTeamGoal",t);this.set("awayTeamGoals",t)}this.fireEvent("onScored",e);return this},removeGoal:function(e){var t;if(e==="home"){t=this.get("homeTeamGoals");t-=1;t=this.filter("removeHomeTeamGoal",t);if(t>=0){this.set("homeTeamGoals",t)}}else if(e==="away"){t=this.get("awayTeamGoals");t-=1;t=this.filter("removeAwayTeamGoal",t);if(t>=0){this.set("awayTeamGoals",t)}}this.fireEvent("onGoalRemoved",e);return this},resetGoals:function(e){if(e==="home"){this.set("homeTeamGoals",0)}else if(e==="away"){this.set("awayTeamGoals",0)}this.fireEvent("onGoalsReset",e);return this},startTime:function(){var e=this;clearInterval(this.timer);this.timer=setInterval(function(){e.increaseTime()},1*this.options.secondLength);this.fireEvent("onStartTime");return this},stopTime:function(){clearInterval(this.timer);this.fireEvent("onStopTime");return this},increaseTime:function(){var e=this.options.time,t=Number.from(e.split(":")[1]),n=Number.from(e.split(":")[0]);if(this.options.timeDirection==="down"){t-=1;if(t<0&&n>0){t=59;n-=1}else if(t>0&&n===0){t-=1}if(t<0){t=0}}else{t+=1;if(t>=60){t=0;n+=1}}t=t<10?"0"+String.from(t):String.from(t);n=n<10?"0"+String.from(n):String.from(n);e=n+":"+t;e=this.filter("increaseTime",e);this.set("time",e);this.fireEvent("onTimeIncreased");return this},decreaseTime:function(){var e=this.options.time,t=Number.from(e.split(":")[1]),n=Number.from(e.split(":")[0]);if(t>0||n>0){t-=1}if(t<0&&n>0){t=59;n-=1}t=t<10?"0"+String.from(t):String.from(t);n=n<10?"0"+String.from(n):String.from(n);e=n+":"+t;e=this.filter("decreaseTime",e);this.set("time",e);this.fireEvent("onTimeDecreased");return this},resetTime:function(){this.set("time","00:00");this.fireEvent("onTimeReset");return this},getScoreboardElement:function(e){return this.element.getElements('[data-scoreboard-bind="'+e+'"]')},showMessage:function(e,t,n){n=n||"bottomCenter";t.scoreboard=this.options;var r=document.id(e).get("html"),i=this;if(this.message.hasClass("isShowing")){this.messageQueue.push([e,t,n])}else{this.message.set("styles",{bottom:"-20px",left:"50%",marginLeft:-(this.message.getWidth()/2)}).set("html",this.tim(r,t)).addClass("isShowing");this.messageMorph.start({opacity:[0,1],bottom:[-20,20]});setTimeout(function(){i.hideMessage()},this.options.duration)}},hideMessage:function(){var e=this,t,n=new Fx.Morph(this.message,{duration:this.options.animationSpeed,onComplete:function(){e.message.removeClass("isShowing");if(e.messageQueue.length>0){t=e.messageQueue[0];e.showMessage(t[0],t[1],t[2]);e.messageQueue.shift()}}});n.start({opacity:[1,0],bottom:[20,-20]})},applyFilter:function(e,t){this.filters[e]=t},filter:function(e,t){if(this.filters.hasOwnProperty(e)&&typeof this.filters[e]==="function"){return this.filters[e](t)}else{return t}},toJSON:function(){return JSON.stringify(this.options)},tim:function(){var e=/{{\s*([a-z0-9_][\\.a-z0-9_]*)\s*}}/gi;return function(t,n){return t.replace(e,function(e,t){for(var r=t.split("."),i=r.length,s=n,o=0;o<i;o++){s=s[r[o]];if(s===void 0)throw"tim: '"+r[o]+"' not found in "+e;if(o===i-1)return s}})}}()});String.extend("shortName",function(e){return e.slice(0,3).toUpperCase()})})(window)